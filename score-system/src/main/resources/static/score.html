<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>成绩信息管理</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h2>成绩信息管理</h2>

    <!-- 新增成绩表单 -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">新增成绩</h5>
            <form id="scoreForm">
                <div class="mb-3">
                    <label class="form-label">学号</label>
                    <input type="text" class="form-control" id="scoreStudentId" placeholder="请输入学号" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">课程名</label>
                    <input type="text" class="form-control" id="courseName" placeholder="请输入课程名" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">成绩</label>
                    <input type="number" class="form-control" id="scoreNum" placeholder="0-100" min="0" max="100" required>
                </div>
                <button type="button" class="btn btn-primary" onclick="addScore()">新增成绩</button>
            </form>
        </div>
    </div>

    <!-- 查询区域 -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">查询成绩</h5>
            <div class="mb-3">
                <input type="text" id="scoreQueryId" class="form-control w-25 d-inline" placeholder="输入学号查询">
                <button class="btn btn-success ms-2" onclick="queryScore()">查询</button>
                <button class="btn btn-info ms-2" onclick="getAllScores()">显示所有成绩</button>
            </div>
            <div id="scoreResultArea" class="mt-3"></div>
        </div>
    </div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script>
    // 新增成绩
    function addScore() {
        let studentId = $("#scoreStudentId").val();
        let courseName = $("#courseName").val();
        let score = $("#scoreNum").val();

        if (!studentId || !courseName || !score) {
            alert("请填写所有字段！");
            return;
        }

        let scoreData = {
            studentId: studentId,
            courseName: courseName,
            score: parseInt(score)
        };

        $.ajax({
            //url: "/score/add",
            url: "http://localhost:8080/score/add",
            type: "POST",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(scoreData),
            success: function (res) {
                alert(res);
                $("#scoreForm")[0].reset();
                getAllScores();
            },
            error: function (xhr) {
                alert("新增成绩失败！错误信息：" + xhr.responseText);
            }
        });
    }

    // 根据学号查询成绩
    function queryScore() {
        let studentId = $("#scoreQueryId").val();
        if (!studentId) {
            alert("请输入学号！");
            return;
        }

        $.ajax({
            //url: "/score/query",
            url: "http://localhost:8080/score/query",
            type: "GET",
            data: {studentId: studentId},
            success: function (res) {
                if (res.length > 0) {
                    let html = `<table class="table table-bordered">
                                    <tr><th>学号</th><th>课程名</th><th>成绩</th></tr>`;
                    res.forEach(function (sc) {
                        html += `<tr>
                                    <td>${sc.studentId}</td>
                                    <td>${sc.courseName}</td>
                                    <td>${sc.score}</td>
                                </tr>`;
                    });
                    html += `</table>`;
                    $("#scoreResultArea").html(html);
                } else {
                    $("#scoreResultArea").html("<p class='text-danger'>未查询到该学生成绩！</p>");
                }
            },
            error: function () {
                alert("查询成绩失败！");
            }
        });
    }

    // 查询所有成绩
    function getAllScores() {
        $.ajax({
            // url: "/score/list",
            url: "http://localhost:8080/score/list",
            type: "GET",
            success: function (res) {
                if (res.length > 0) {
                    let html = `<table class="table table-bordered">
                                    <tr><th>学号</th><th>课程名</th><th>成绩</th></tr>`;
                    res.forEach(function (sc) {
                        html += `<tr>
                                    <td>${sc.studentId}</td>
                                    <td>${sc.courseName}</td>
                                    <td>${sc.score}</td>
                                </tr>`;
                    });
                    html += `</table>`;
                    $("#scoreResultArea").html(html);
                } else {
                    $("#scoreResultArea").html("<p class='text-muted'>暂无成绩数据！</p>");
                }
            },
            error: function () {
                alert("查询所有成绩失败！");
            }
        });
    }
</script>
</body>
</html>